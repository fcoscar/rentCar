{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useIntersection = useIntersection;\n\nvar _react = require(\"react\");\n\nvar _requestIdleCallback = require(\"./request-idle-callback\");\n\nconst hasIntersectionObserver = typeof IntersectionObserver === 'function';\n\nfunction useIntersection(_ref) {\n  let {\n    rootRef,\n    rootMargin,\n    disabled\n  } = _ref;\n  const isDisabled = disabled || !hasIntersectionObserver;\n  const unobserve = (0, _react).useRef();\n  const [visible, setVisible] = (0, _react).useState(false);\n  const [element, setElement] = (0, _react).useState(null);\n  (0, _react).useEffect(() => {\n    if (hasIntersectionObserver) {\n      if (unobserve.current) {\n        unobserve.current();\n        unobserve.current = undefined;\n      }\n\n      if (isDisabled || visible) return;\n\n      if (element && element.tagName) {\n        unobserve.current = observe(element, isVisible => isVisible && setVisible(isVisible), {\n          root: rootRef == null ? void 0 : rootRef.current,\n          rootMargin\n        });\n      }\n\n      return () => {\n        unobserve.current == null ? void 0 : unobserve.current();\n        unobserve.current = undefined;\n      };\n    } else {\n      if (!visible) {\n        const idleCallback = (0, _requestIdleCallback).requestIdleCallback(() => setVisible(true));\n        return () => (0, _requestIdleCallback).cancelIdleCallback(idleCallback);\n      }\n    }\n  }, [element, isDisabled, rootMargin, rootRef, visible]);\n  const resetVisible = (0, _react).useCallback(() => {\n    setVisible(false);\n  }, []);\n  return [setElement, visible, resetVisible];\n}\n\nfunction observe(element, callback, options) {\n  const {\n    id,\n    observer,\n    elements\n  } = createObserver(options);\n  elements.set(element, callback);\n  observer.observe(element);\n  return function unobserve() {\n    elements.delete(element);\n    observer.unobserve(element); // Destroy observer when there's nothing left to watch:\n\n    if (elements.size === 0) {\n      observer.disconnect();\n      observers.delete(id);\n      const index = idList.findIndex(obj => obj.root === id.root && obj.margin === id.margin);\n\n      if (index > -1) {\n        idList.splice(index, 1);\n      }\n    }\n  };\n}\n\nconst observers = new Map();\nconst idList = [];\n\nfunction createObserver(options) {\n  const id = {\n    root: options.root || null,\n    margin: options.rootMargin || ''\n  };\n  const existing = idList.find(obj => obj.root === id.root && obj.margin === id.margin);\n  let instance;\n\n  if (existing) {\n    instance = observers.get(existing);\n\n    if (instance) {\n      return instance;\n    }\n  }\n\n  const elements = new Map();\n  const observer = new IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      const callback = elements.get(entry.target);\n      const isVisible = entry.isIntersecting || entry.intersectionRatio > 0;\n\n      if (callback && isVisible) {\n        callback(isVisible);\n      }\n    });\n  }, options);\n  instance = {\n    id,\n    observer,\n    elements\n  };\n  idList.push(id);\n  observers.set(id, instance);\n  return instance;\n}\n\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"mappings":"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","names":["useIntersection","hasIntersectionObserver","IntersectionObserver","rootRef","rootMargin","disabled","isDisabled","unobserve","useRef","visible","setVisible","useState","element","setElement","useEffect","current","undefined","tagName","observe","isVisible","root","idleCallback","requestIdleCallback","cancelIdleCallback","resetVisible","useCallback","callback","options","id","observer","elements","createObserver","set","delete","size","disconnect","observers","index","idList","findIndex","obj","margin","splice","Map","existing","find","instance","get","entries","forEach","entry","target","isIntersecting","intersectionRatio","push"],"sources":["../../client/use-intersection.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}